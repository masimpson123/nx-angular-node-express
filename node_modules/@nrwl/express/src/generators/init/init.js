"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.initSchematic = exports.initGenerator = void 0;
const tslib_1 = require("tslib");
const devkit_1 = require("@nrwl/devkit");
const set_default_collection_1 = require("@nrwl/workspace/src/utilities/set-default-collection");
const node_1 = require("@nrwl/node");
const versions_1 = require("../../utils/versions");
function updateDependencies(tree) {
    (0, devkit_1.updateJson)(tree, 'package.json', (json) => {
        delete json.dependencies['@nrwl/express'];
        return json;
    });
    return (0, devkit_1.addDependenciesToPackageJson)(tree, {
        express: versions_1.expressVersion,
    }, {
        '@types/express': versions_1.expressTypingsVersion,
        '@nrwl/express': versions_1.nxVersion,
    });
}
function initGenerator(tree, schema) {
    return (0, tslib_1.__awaiter)(this, void 0, void 0, function* () {
        (0, set_default_collection_1.setDefaultCollection)(tree, '@nrwl/express');
        const initTask = yield (0, node_1.initGenerator)(tree, schema);
        const installTask = updateDependencies(tree);
        if (!schema.skipFormat) {
            yield (0, devkit_1.formatFiles)(tree);
        }
        return () => (0, tslib_1.__awaiter)(this, void 0, void 0, function* () {
            yield initTask();
            yield installTask();
        });
    });
}
exports.initGenerator = initGenerator;
exports.default = initGenerator;
exports.initSchematic = (0, devkit_1.convertNxGenerator)(initGenerator);
//# sourceMappingURL=init.js.map